<div class="faq-sec">
    <div class="container-fluid">
        <div class="heading with-link">
            <h2>{{ section.settings.heading }}</h2>
            <div class="heading-link hide-mobile">
                <a href="{{ section.settings.cta_url }}">{{ section.settings.cta_text }}</a>
            </div>
        </div>
        <div class="faq-wrap">
            <div class="faq-accordian-wrapper">
                {% for item in product.metafields.custom.faqs.value %}
                    <div class="faq-item" data-image="{{ item.faq_image | img_url: 'master' }}">
                        <div class="faq-question">
                            <div class="faq-question-left">
                                <div class="f-question">
                                  <h3>{{ item.faq_label }}</h3>
                                </div>
                            </div>
                            <div class="faq-question-right">
                                {% render 'plus' %}
                            </div>
                        </div>
                        <div class="faq-answer">
                            <div class="f-answer">
                                {{ item.faq_data | metafield_tag }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="faq-image">
                <img id="faq-dynamic-image" width="100%" height="100%" src="{{ section.settings.faq_image | img_url:'master' }}" alt="{{ section.settings.faq_image.alt }}">
            </div>
        </div>

        <div class="heading-link show-mobile">
                <a href="{{ section.settings.cta_url }}">{{ section.settings.cta_text }}</a>
            </div>
    </div>
</div>

<script>
$(document).ready(function () {
    var $mainImage = $('#faq-dynamic-image');

    // 1. Initialize: Set image to the first item's image on load
    var firstImage = $('.faq-item').first().data('image');
    if(firstImage) {
        $mainImage.attr('src', firstImage);
    }

    var $firstItem = $('.faq-item').first();
    $firstItem.addClass('active');
    $firstItem.find('.faq-answer').show();

    $('.faq-question').click(function () {
        var $faqItem = $(this).parent('.faq-item');
        var $faqAnswer = $faqItem.find('.faq-answer');
        var newImageUrl = $faqItem.data('image'); // Get image URL from data attribute

        if ($faqItem.hasClass('active')) {
            $faqItem.removeClass('active');
            $faqAnswer.slideUp();
        } else {
            $('.faq-item').removeClass('active');
            $('.faq-answer').slideUp();
            
            $faqItem.addClass('active');
            $faqAnswer.slideDown();

            // 2. Change the image with a simple fade effect
            if(newImageUrl) {
                $mainImage.fadeOut(200, function() {
                    $(this).attr('src', newImageUrl).fadeIn(200);
                });
            }
        }
    });
});
</script>

{% schema %}
  {
    "name": "FAQ Section",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Frequently Asked Questions"
      },
      {
        "type": "url",
        "id": "cta_url",
        "label": "CTA URL (right side link)"
        },
      {
        "type": "text",
        "id": "cta_text",
        "label": "CTA text",
        "default": "All FAQs"
      },
      {
        "type": "image_picker",
        "id": "faq_image",
        "label": "FAQ Section Image"
      }
    ],
    "presets": [
      {
        "name": "FAQ Section"
      }
    ]
  }
{% endschema %}


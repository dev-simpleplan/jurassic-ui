<section class="login-signup-template">
  <div class="log-form-wrap">
    <div class="container">
      <div class="log-form-con" id="loginForm">
        <div class="head">
          <h1>{{ section.settings.head }}</h1>
        </div>
        <div class="log-form">
          {% form 'customer_login' %}
            {% if form.errors %}
              {{ form.errors | default_errors }}
            {% endif %}
            <div class="form-con-wrap">
              <div class="form-con">
                <label for="customer_email">EMAIL ADDRESS<sup>*</sup></label>
                <input
                  type="email"
                  name="customer[email]"
                  id="customer_email"
                  placeholder="Enter your email address"
                  required
                  autocomplete="email"
                  pattern="[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$"
                />
              </div>
              <div class="form-con">
                <label for="customer_password">PASSWORD<sup>*</sup></label>
                <input
                  type="password"
                  name="customer[password]"
                  id="customer_password"
                  placeholder="Enter Password"
                  required
                  autocomplete="current-password"
                  title="8+ characters"
                />
                <a href="#recover" id="forgotPassword">Forgot Password?</a>
              </div>
            </div>
            <div class="form-con checkbox">
              <input
                type="checkbox"
                name="customer[accepts_terms_conditions]"
                id="accepts_terms_conditions"
                required
              >
              <label for="accepts_terms_conditions">
                I agree to <a href="{{ section.settings.page.url }}">terms of service</a>
              </label>
            </div>
            <div class="form-con submit-but">
              <button type="submit">LogIn</button>
            </div>
          {% endform %}
          <div class="cc-signup">
            Make your account! {{ 'Sign In' | customer_register_link }}
          </div>
        </div>
      </div>
      <div class="log-form-con forget" id="recoverPasswordForm" style="display:none;">
        <div class="head">
          <h1>{{ section.settings.fp-head }}</h1>
          <p>We’ve got this.  Just share your email below and we’ll share a secret link to reset your password.</p>
        </div>
        <div class="log-form">
          {% form 'recover_customer_password' %}
            {% if form.posted_successfully? %}
              <div id="resetSuccess" class="form-success">
                <p>We've sent you an email with a link to reset your password.</p>
              </div>
            {% else %}
              {% if form.errors %}
                {{ form.errors | default_errors }}
              {% endif %}
              <div class="form-con-wrap">
                <div class="form-con">
                  <label for="recover_email">EMAIL ADDRESS<sup>*</sup></label>
                  <input
                    type="email"
                    name="email"
                    id="recover_email"
                    placeholder="Enter your email address"
                    required
                    autocomplete="email"
                  />
                </div>
              </div>
              <div class="form-con submit-but">
                <button type="submit">Send Reset Link</button>
              </div>
            {% endif %}
          {% endform %}
          <div class="cc-signup">
            <a href="#" id="hideRecoverPasswordLink">Back To Login</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="log-img">
    <img src="{{ section.settings.bg-img | img_url: 'master' }}" alt="">
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const recoverPasswordForm = document.getElementById('recoverPasswordForm');
    const forgotPasswordLink = document.getElementById('forgotPassword');
    const hideRecoverPasswordLink = document.getElementById('hideRecoverPasswordLink');
    const emailInput = document.getElementById('customer_email');

    forgotPasswordLink.addEventListener('click', function(event) {
      event.preventDefault();
      loginForm.style.display = 'none';
      recoverPasswordForm.style.display = 'block';
    });

    hideRecoverPasswordLink.addEventListener('click', function(event) {
      event.preventDefault();
      recoverPasswordForm.style.display = 'none';
      loginForm.style.display = 'block';
    });

    // Add new event listeners for email input
    emailInput.addEventListener('input', validateEmail);
    emailInput.addEventListener('change', validateEmail);
    emailInput.addEventListener('blur', validateEmail);

    function validateEmail() {
      const emailPattern = /[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$/;
      if (emailPattern.test(emailInput.value)) {
        emailInput.setCustomValidity('');
      } else {
        emailInput.setCustomValidity('Please enter a valid email address');
      }
    }

    const recoverForm = document.querySelector('#recoverPasswordForm form');
    const resetSuccess = document.getElementById('resetSuccess');

    if (recoverForm) {
      recoverForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(recoverForm);
        fetch(recoverForm.action, {
          method: 'POST',
          body: formData
        }).then(response => {
          if (response.ok) {
            resetSuccess.style.display = 'block';
            recoverForm.reset();
          } else {
            console.error('Form submission failed');
          }
        }).catch(error => {
          console.error('Error:', error);
        });
      });
    }
  });
</script>

{% schema %}
  {
    "name": "Login",
    "settings": [
      {
        "type": "text",
        "id": "head",
        "label": "Heading",
        "default": "Welcome back!"
      },
      {
        "type": "image_picker",
        "id": "bg-img",
        "label": "Image"
      },
      {
        "type": "page",
        "id": "page",
        "label": "Select terms and condition"
      },
      {
        "type": "text",
        "id": "fp-head",
        "label": "Forget Password Heading",
        "default": "Forgot Password"
      }
    ]
  }
{% endschema %}

<div class="product-card-primary">
  <div class="fruits_card">
    <a href="{{ product.url }}">
      <div class="fc_top">
        {% assign images = product.images %}

        <div class="fc_image">
          {% if images.size > 0 %}
            <img
              src="{{ images.first | img_url: 'master' }}"
              alt="{{ product.title | escape }}"
              class="img_sizing primary-img">

            {% if images.size > 1 %}
              <img
                src="{{ images[1] | img_url: 'master' }}"
                alt="{{ product.title | escape }}"
                class="img_sizing hover-img">
            {% endif %}
          {% else %}
            <img
              src="{{ 'https://cdn.shopify.com/s/files/1/0752/8015/4881/files/placeholder.jpg?v=1760532683' }}"
              alt="No Image Available"
              class="img_sizing primary-img">
          {% endif %}
        </div>


        {% assign product_tags = product.tags | downcase %}
        {% if product.tags.size > 0 %}
          <div class="fc_category_tags">
            {% for tag in product.tags %}
              {% unless tag == 'Best Seller' %}
                <span>{{ tag }}</span>
              {% endunless %}
            {% endfor %}
          </div>
        {% endif %}

        {% if product.tags contains 'Best Seller' %}
          <div class="fc_bestsell_tags">
            <span>Bestseller</span>
          </div>
        {% endif %}

        {% if product.metafields.custom.certificate %}
          {% assign certificate = product.metafields.custom.certificate.value %}
          {% for item in product.metafields.custom.certificate.value %}
            <div class="fc_organic_auth">
              <img
                src="{{ item.badge_image | img_url:'master' }}"
                alt="{{ item.display_name }}"
                class="img_sizing">
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </a>

    <div class="fc_bottom_outer">
      <div class="fc_bottom">

        <div class="fc_bottom_top">
          <div class="star_review">
            <div class="star_rating">
              <p data-oke-star-rating data-oke-reviews-product-id="shopify-{{ product.id }}"></p>
            </div>
            <div class="rating_info">
              {% if product.metafields.custom.country_of_origin %}
                <span class="dot_seperator"></span>
                <p>{{ product.metafields.custom.country_of_origin.value.country_name }}</p>
              {% endif %}
            </div>
          </div>
          <p class="fc_product_title">
            <a href="{{ product.url }}">{{ product.title | truncate: 50 }}</a>
          </p>
          
        </div>

        <div class="fc_bottom_bottom">
          <div class="fc_bottom_center">
            <div class="fc_variant_outer">
              <div class="fc_variant_wrap">
                {% for variant in product.variants %}
                  <script type="application/JSON">
                    {{ variant | json }}
                  </script>
                  <div
                    class="fc_variant_item {% if variant.metafields.custom.is_prior == true %} active {% endif %} {% if variant.metafields.custom.bestseller == true %} bestseller{% endif %}"
                    data-id="{{ variant.id }}"
                    data-price="{{ variant.price | money }}"
                    data-compare="{{ variant.compare_at_price | money }}"
                    data-inventory="{{ variant.inventory_quantity }}"
                    data-unit="{{ variant.unit_price | money }} / {{ variant.unit_price_measurement.reference_unit }}"
                    data-image="{{ variant.image | img_url: 'master' }}">
                    {% if variant.metafields.custom.bestseller == true %}
                      <div class="vv-bestseller">Bestseller</div>
                    {% endif %}
                    <p class="weight">
                      {{ variant.title }}
                      {% if variant.compare_at_price > variant.price %}
                        <span>
                          {{
                            variant.compare_at_price | minus: variant.price | times: 100 | divided_by: variant.compare_at_price | round
                          -}}
                          % Off
                        </span>
                      {% endif %}
                    </p>
                    <p class="quantity">
                      {% if variant.unit_price_measurement.quantity_value == 1 %}
                        {{ variant.unit_price_measurement.quantity_value | round }} Peice
                      {% else %}
                        {{ variant.unit_price_measurement.quantity_value | round }} Peices
                      {% endif %}
                    </p>
                  </div>
                {% endfor %}
              </div>
              <div class="selected_variant_dropdown"></div>
            </div>
          </div>

          <div class="fc_bottom_end">
            <div class="fc_price_weight">
              {% assign current_variant = nil %}
              {% for variant in product.variants %}
                {% if variant.metafields.custom.is_prior == true and variant.available %}
                  {% assign current_variant = variant %}
                  {% break %}
                {% endif %}
              {% endfor %}
              {% if current_variant == nil %}
                {% assign current_variant = product.selected_or_first_available_variant %}
              {% endif %}

              {% if current_variant.compare_at_price > current_variant.price %}
                <p>
                  <strike id="compare_price">{{ current_variant.compare_at_price | money }}</strike>
                  <span class="selling_price">{{ current_variant.price | money }}</span>
                </p>
              {% else %}
                <p>
                  <span class="selling_price">{{ current_variant.price | money }}</span>
                </p>
              {% endif %}

              <p class="fc_weight">
                {% if current_variant.unit_price_measurement %}
                  {{ current_variant.unit_price | money }} / {{ current_variant.unit_price_measurement.reference_unit }}
                {% else %}
                  {{ current_variant.price | money }} / unit
                {% endif %}
              </p>
            </div>
            <div class="fc_add_to_cart_outer">
              <form
                action="/cart/add"
                method="post"
                enctype="multipart/form-data">
                <input
                  type="hidden"
                  name="id"
                  value="{{ current_variant.id }}">
                <input
                  type="hidden"
                  name="quantity"
                  value="1">
                <div class="fc_add_to_cart"
                    data-variant-id="{{ current_variant.id }}"
                    data-available="{{ current_variant.available }}"
                    data-inventory="{{ current_variant.inventory_quantity }}">

                  <button
                    class="add-to-cart-btn"
                    {% unless current_variant.available %}disabled{% endunless %}>
                    {% if current_variant.available %}Add to Cart{% else %}Sold Out{% endif %}
                  </button>

                  <div class="qty-controls">
                    <span class="remove_product">â€“</span>
                    <span class="qty-value">1</span>
                    <span class="add_product">+</span>
                  </div>
                </div>


              </form>
            </div>
            <div class="fc_trust_text">
              <p>Only {{ current_variant.inventory_quantity }} Left</p>
              <span class="dot_seperator"></span>
              <p>Ships in 24 hrs</p>
              <span class="dot_seperator"></span>
              <p>{{ product.metafields.custom.benefit | default: 'Product Benefit' }}</p>
            </div>
          </div>
        </div>


      </div>
    </div>
  </div>
</div>


<style>

  .fc_add_to_cart {
  display: flex;
  align-items: center;
  gap: 12px;
}

.fc_add_to_cart .remove_product,
.fc_add_to_cart .add_product,
.fc_add_to_cart .qty-value {
  display: none;
}

.fc_add_to_cart.active .remove_product,
.fc_add_to_cart.active .add_product,
.fc_add_to_cart.active .qty-value {
  display: inline-flex;
}

.fc_add_to_cart.active .add-to-cart-btn {
  display: none;
}
.fc_add_to_cart {
  display: flex;
  justify-content: center;
}

.fc_add_to_cart .qty-controls {
  display: none;
  align-items: center;
  gap: 12px;
}

.fc_add_to_cart.active .qty-controls {
  display: flex;
}

.fc_add_to_cart.active .add-to-cart-btn {
  display: none;
}

.qty-controls span {
  cursor: pointer;
  user-select: none;
  font-size: 18px;
  font-weight: 600;
}


</style>

  <script>
document.addEventListener('DOMContentLoaded', () => {

  async function addToCart(id, qty) {
    return fetch('/cart/add.js', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, quantity: qty })
    }).then(r => r.json());
  }

  async function changeCart(key, qty) {
    return fetch('/cart/change.js', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: key, quantity: qty })
    });
  }

  async function getCart() {
    return fetch('/cart.js').then(r => r.json());
  }

  document.querySelectorAll('.fc_add_to_cart').forEach(card => {

    if (card.dataset.available !== 'true') return;

    const variantId = card.dataset.variantId;
    const maxQty = parseInt(card.dataset.inventory, 10) || Infinity;

    const addBtn = card.querySelector('.add-to-cart-btn');
    const plus = card.querySelector('.add_product');
    const minus = card.querySelector('.remove_product');
    const qtyEl = card.querySelector('.qty-value');

    let qty = 0;
    let lineKey = null;

    addBtn.addEventListener('click', async () => {
      await addToCart(variantId, 1);
      qty = 1;
      qtyEl.textContent = qty;
      card.classList.add('active');

      const cart = await getCart();
      const item = cart.items.find(i => i.variant_id == variantId);
      if (item) lineKey = item.key;
    });

    plus.addEventListener('click', async () => {
      if (qty >= maxQty) return;
      qty++;
      qtyEl.textContent = qty;
      await changeCart(lineKey, qty);
    });

    minus.addEventListener('click', async () => {
      qty--;
      if (qty <= 0) {
        await changeCart(lineKey, 0);
        card.classList.remove('active');
        qty = 0;
        return;
      }
      qtyEl.textContent = qty;
      await changeCart(lineKey, qty);
    });
  });
});
</script>
